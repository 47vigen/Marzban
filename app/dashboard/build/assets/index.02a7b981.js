import{e as He,$ as Pe,R as Q,r as s,u as ke,m as me,j as e,c as h,U as Ne,C as $e,a as Ze,b as o,H as I,T as f,d as je,B as _,L as Oe,M as Ve,S as Ge,f as Qe,g as we,h as R,i as Ye,I as z,k as w,l as qe,n as Xe,o as Ke,Q as Se,p as Ie,W as Je,N as et,E as tt,q as rt,s as ot,t as fe,v as O,w as at,x as V,y as ge,z as G,F as $,A as nt,D as st,G as lt,J as it,K as ct,O as dt,P as pt,V as _e,X as ht,Y as ve,Z as Ee,_ as ee,a0 as ut,a1 as mt,a2 as ft,a3 as Ue,a4 as gt,a5 as bt,a6 as xt,a7 as L,a8 as F,a9 as yt,aa as Ct,ab as kt,ac as wt,ad as St,ae as It,af as Me,ag as _t,ah as te,ai as re,aj as oe,ak as ae,al as ne,am as se,an as ze,ao as vt,ap as Et,aq as E,ar as Ut,as as Re,at as Le,au as D,av as Y,aw as Mt,ax as zt,ay as X,az as K,aA as Rt,aB as Lt,aC as Ft,aD as Wt,aE as At,aF as Dt,aG as Tt,aH as Bt,aI as Ht,aJ as Pt,aK as Nt,aL as $t,aM as Zt,aN as jt,aO as Ot,aP as Vt}from"./vendor.495ab913.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const p of i.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function a(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerpolicy&&(i.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?i.credentials="include":l.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(l){if(l.ep)return;l.ep=!0;const i=a(l);fetch(l.href,i)}})();const Gt=He({shadows:{outline:"0 0 0 2px var(--chakra-colors-primary-200)"},fonts:{body:"Inter,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif"},colors:{"light-border":"#d2d2d4",primary:{50:"#9cb7f2",100:"#88a9ef",200:"#749aec",300:"#618ce9",400:"#4d7de7",500:"#396fe4",600:"#3364cd",700:"#2e59b6",800:"#284ea0",900:"#224389"},gray:{750:"#222C3B"}},components:{Alert:{baseStyle:{container:{borderRadius:"6px",fontSize:"sm"}}},Select:{baseStyle:{field:{_dark:{borderColor:"gray.600"}}}},FormHelperText:{baseStyle:{fontSize:"xs"}},FormLabel:{baseStyle:{fontSize:"sm",fontWeight:"medium",mb:"1",_dark:{color:"gray.300"}}},Input:{baseStyle:{addon:{_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}},field:{_focusVisible:{boxShadow:"none",borderColor:"primary.200",outlineColor:"primary.200"},_dark:{borderColor:"gray.600",_placeholder:{color:"gray.500"}}}}},Table:{baseStyle:{table:{borderCollapse:"separate",borderSpacing:0},thead:{borderBottomColor:"light-border"},th:{background:"#F9FAFB",borderColor:"light-border !important",borderBottomColor:"light-border !important",borderTop:"1px solid ",borderTopColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border !important"},_last:{borderRight:"1px solid",borderColor:"light-border !important"},_dark:{borderColor:"gray.600 !important",background:"gray.750"}},td:{transition:"all .1s ease-out",borderColor:"light-border",borderBottomColor:"light-border !important",_first:{borderLeft:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_last:{borderRight:"1px solid",borderColor:"light-border",_dark:{borderColor:"gray.600"}},_dark:{borderColor:"gray.600",borderBottomColor:"gray.600 !important"}},tr:{"&.interactive":{cursor:"pointer",_hover:{"& > td":{bg:"gray.200"},_dark:{"& > td":{bg:"gray.750"}}}},_last:{"& > td":{_first:{borderBottomLeftRadius:"8px"},_last:{borderBottomRightRadius:"8px"}}}}}}}});const J=()=>localStorage.getItem("token"),Qt=t=>{localStorage.setItem("token",t)},Yt=Pe.create({baseURL:"/api/"}),Fe=(t,r={})=>(J()&&(r.headers={...(r==null?void 0:r.headers)||{},Authorization:`Bearer ${J()}`}),Yt(t,r)),H=Fe,We={editingUser:null,deletingUser:null,isCreatingNewUser:!1,qrcodeLinks:null,users:[],filteredUsers:[],loading:!0,filters:{search:""},onCreateUser:()=>{},onEditingUser:t=>{},onDeletingUser:t=>{},refetchUsers:()=>{},onFilterChange:t=>{},setQRCode:t=>{},deleteUser:t=>new Promise(()=>{}),createUser:t=>new Promise(()=>{}),editUser:t=>new Promise(()=>{})},Ae=Q.createContext(We),W=()=>s.exports.useContext(Ae),qt=(t,r)=>{switch(r.type){case"CreatingNewUser":return{...t,isCreatingNewUser:r.isOpen};case"EditingUser":return{...t,editingUser:r.user};case"DeletingUser":return{...t,deletingUser:r.user};case"FilterChange":return{...t,filters:r.filters};case"SetQrCode":return{...t,qrcodeLinks:r.links};default:return t}},Xt=({children:t})=>{const[r,a]=s.exports.useReducer(qt,We),{data:c,isValidating:l,mutate:i}=ke("/users"),p=s.exports.useCallback(d=>{a({type:"CreatingNewUser",isOpen:d})},[]),n=s.exports.useCallback(()=>{i()},[]),g=s.exports.useCallback(d=>{a({type:"EditingUser",user:d})},[]),u=s.exports.useCallback(d=>{a({type:"DeletingUser",user:d})},[]),b=s.exports.useCallback(d=>{a({type:"FilterChange",filters:d})},[]),y=s.exports.useCallback(d=>(g(null),H(`/user/${d.username}`,{method:"DELETE"}).then(()=>{u(null),n(),me("/system")})),[]),C=s.exports.useCallback(d=>H("/user",{method:"POST",body:d}).then(()=>{g(null),n(),me("/system")}),[]),S=s.exports.useCallback(d=>H(`/user/${d.username}`,{method:"PUT",body:d}).then(()=>{g(null),n()}),[]),m=s.exports.useCallback(d=>{a({type:"SetQrCode",links:d})},[]),U=s.exports.useMemo(()=>c?c.filter(d=>d.username.indexOf(r.filters.search)>-1):[],[r.filters,c]),T={...r,users:c||[],filteredUsers:U,loading:l,refetchUsers:n,onEditingUser:g,onDeletingUser:u,onCreateUser:p,onFilterChange:b,deleteUser:y,createUser:C,editUser:S,setQRCode:m};return e(Ae.Provider,{value:T,children:t})};function P(t,r=2){if(!+t)return"0 B";const a=1024,c=r<0?0:r,l=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(a));return`${parseFloat((t/Math.pow(a,i)).toFixed(c))} ${l[i]}`}const Kt=t=>{if(t)return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Jt=h(Ne,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),er=h($e,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),tr=h(Ze,{baseStyle:{w:5,h:5,position:"relative",zIndex:"2"}}),q=({title:t,content:r,icon:a})=>o(je,{p:6,borderWidth:"1px",borderColor:"light-border",bg:"#F9FAFB",_dark:{borderColor:"gray.600",bg:"gray.750"},borderStyle:"solid",boxShadow:"none",borderRadius:"12px",width:"full",display:"flex",justifyContent:"space-between",flexDirection:"row",children:[o(I,{alignItems:"center",experimental_spaceX:"4",children:[e(_,{p:"2",position:"relative",color:"white",_before:{content:'""',position:"absolute",top:0,left:0,bg:"primary.400",display:"block",w:"full",h:"full",borderRadius:"5px",opacity:".5",z:"1"},_after:{content:'""',position:"absolute",top:"-5px",left:"-5px",bg:"primary.400",display:"block",w:"calc(100% + 10px)",h:"calc(100% + 10px)",borderRadius:"8px",opacity:".4",z:"1"},children:a}),e(f,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",textTransform:"capitalize",fontSize:"sm",children:t})]}),e(_,{fontSize:"3xl",fontWeight:"semibold",mt:"2",children:r})]}),rr=t=>{const{data:r}=ke("/system",{revalidateIfStale:!0,revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshInterval:5e3});return o(I,{justifyContent:"space-between",gap:0,experimental_spaceX:{lg:"4",md:"0"},experimental_spaceY:{lg:"0",base:"4"},display:{lg:"flex",md:"block"},...t,children:[e(q,{title:"total users",content:r&&Kt(r.total_user),icon:e(Jt,{})}),e(q,{title:"bandwidth usage",content:r&&P(r.incoming_bandwidth+r.outgoing_bandwith),icon:e(er,{})}),e(q,{title:"memory usage",content:r&&o(I,{alignItems:"center",children:[e(f,{children:P(r.mem_used,1)}),o(f,{fontWeight:"normal",fontSize:"lg",as:"span",children:["/ ",P(r.mem_total,1)]})]}),icon:e(tr,{})})]})},or=h(Oe),ar=h(Ve,{baseStyle:{w:"4",h:"4"}}),nr=h(Ge,{baseStyle:{w:"4",h:"4"}}),De=t=>{const{colorMode:r,toggleColorMode:a}=Qe(),c=we();return o(I,{w:"full",py:"0",position:"relative",...t,children:[c.pathname!=="/login"&&e(or,{to:"/login",left:"0",position:"absolute",children:e(R,{size:"sm",children:"Log out"})}),o(f,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:["Made with \u2764\uFE0F in"," ",e(Ye,{color:"blue.400",href:"https://github.com/gozargah",children:"Gozargah"})]}),e(z,{size:"sm","aria-label":"switch theme",onClick:a,position:"absolute",right:"0",children:r==="light"?e(ar,{}):e(nr,{})})]})},sr=({actions:t})=>o(I,{gap:2,justifyContent:"space-between",children:[e(f,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:"Users"}),t&&e(_,{children:t})]}),lr=t=>s.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","data-name":"Layer 1",width:782.04441,height:701.88002,viewBox:"0 0 782.04441 701.88002",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},s.exports.createElement("path",{d:"M609.48783,100.59015l-25.44631,6.56209L270.53735,187.9987,245.091,194.56079A48.17927,48.17927,0,0,0,210.508,253.17865L320.849,681.05606a48.17924,48.17924,0,0,0,58.61776,34.58317l.06572-.01695,364.26536-93.93675.06572-.01695a48.17923,48.17923,0,0,0,34.58309-58.6178l-110.341-427.87741A48.17928,48.17928,0,0,0,609.48783,100.59015Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M612.94784,114.00532l-30.13945,7.77236L278.68955,200.20385l-30.139,7.77223a34.30949,34.30949,0,0,0-24.6275,41.74308l110.341,427.87741a34.30946,34.30946,0,0,0,41.7431,24.62736l.06572-.01695,364.26536-93.93674.06619-.01707a34.30935,34.30935,0,0,0,24.627-41.7429l-110.341-427.87741A34.30938,34.30938,0,0,0,612.94784,114.00532Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),s.exports.createElement("path",{d:"M590.19,252.56327,405.917,300.08359a8.01411,8.01411,0,0,1-4.00241-15.52046l184.273-47.52033A8.01412,8.01412,0,0,1,590.19,252.56327Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M628.955,270.49906,412.671,326.27437a8.01411,8.01411,0,1,1-4.00241-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M620.45825,369.93676l-184.273,47.52032a8.01411,8.01411,0,1,1-4.00242-15.52046l184.273-47.52032a8.01411,8.01411,0,1,1,4.00241,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M659.22329,387.87255l-216.284,55.77531a8.01411,8.01411,0,1,1-4.00242-15.52046l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M650.72653,487.31025l-184.273,47.52033a8.01412,8.01412,0,0,1-4.00242-15.52047l184.273-47.52032a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M689.49156,505.246l-216.284,55.77532a8.01412,8.01412,0,1,1-4.00241-15.52047l216.284-55.77531a8.01411,8.01411,0,0,1,4.00242,15.52046Z",transform:"translate(-208.9778 -99.05999)",fill:"#f2f2f2"}),s.exports.createElement("path",{d:"M374.45884,348.80871l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76146L289.5963,304.81607a3.847,3.847,0,0,1,2.76145-4.68061l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76145l14.96947,58.04817A3.847,3.847,0,0,1,374.45884,348.80871Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M404.72712,466.1822l-65.21247,16.817a3.847,3.847,0,0,1-4.68062-2.76146l-14.96946-58.04816A3.847,3.847,0,0,1,322.626,417.509l65.21246-16.817a3.847,3.847,0,0,1,4.68062,2.76145l14.96946,58.04817A3.847,3.847,0,0,1,404.72712,466.1822Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M434.99539,583.55569l-65.21246,16.817a3.847,3.847,0,0,1-4.68062-2.76145l-14.96946-58.04817a3.847,3.847,0,0,1,2.76145-4.68062l65.21247-16.817a3.847,3.847,0,0,1,4.68061,2.76146l14.96947,58.04816A3.847,3.847,0,0,1,434.99539,583.55569Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M863.63647,209.0517H487.31811a48.17928,48.17928,0,0,0-48.125,48.12512V699.05261a48.17924,48.17924,0,0,0,48.125,48.12507H863.63647a48.17924,48.17924,0,0,0,48.125-48.12507V257.17682A48.17928,48.17928,0,0,0,863.63647,209.0517Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M863.637,222.90589H487.31811a34.30948,34.30948,0,0,0-34.271,34.27093V699.05261a34.30947,34.30947,0,0,0,34.271,34.27088H863.637a34.30936,34.30936,0,0,0,34.27051-34.27088V257.17682A34.30937,34.30937,0,0,0,863.637,222.90589Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),s.exports.createElement("circle",{cx:694.19401,cy:614.02963,r:87.85039,fill:"#3182CE"}),s.exports.createElement("path",{d:"M945.18722,701.63087H914.63056V671.07421a11.45875,11.45875,0,0,0-22.9175,0v30.55666H861.1564a11.45875,11.45875,0,0,0,0,22.9175h30.55666V755.105a11.45875,11.45875,0,1,0,22.9175,0V724.54837h30.55666a11.45875,11.45875,0,0,0,0-22.9175Z",transform:"translate(-208.9778 -99.05999)",fill:"#fff"}),s.exports.createElement("path",{d:"M807.00068,465.71551H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01412,8.01412,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M840.05889,492.76314H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01411,8.01411,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M807.00068,586.929H616.699a8.01412,8.01412,0,1,1,0-16.02823H807.00068a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M840.05889,613.97661H616.699a8.01412,8.01412,0,1,1,0-16.02823H840.05889a8.01412,8.01412,0,1,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M574.07028,505.04162H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V441.25158a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,505.04162Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M574.07028,626.25509H506.72434a3.847,3.847,0,0,1-3.84278-3.84278V562.46505a3.847,3.847,0,0,1,3.84278-3.84278h67.34594a3.847,3.847,0,0,1,3.84278,3.84278v59.94726A3.847,3.847,0,0,1,574.07028,626.25509Z",transform:"translate(-208.9778 -99.05999)",fill:"#e6e6e6"}),s.exports.createElement("path",{d:"M807.21185,330.781H666.91017a8.01411,8.01411,0,0,1,0-16.02823H807.21185a8.01411,8.01411,0,0,1,0,16.02823Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),s.exports.createElement("path",{d:"M840.27007,357.82862H666.91017a8.01411,8.01411,0,1,1,0-16.02822h173.3599a8.01411,8.01411,0,0,1,0,16.02822Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"}),s.exports.createElement("path",{d:"M635.85911,390.6071H506.51316a3.847,3.847,0,0,1-3.84277-3.84277V285.81706a3.847,3.847,0,0,1,3.84277-3.84277H635.85911a3.847,3.847,0,0,1,3.84277,3.84277V386.76433A3.847,3.847,0,0,1,635.85911,390.6071Z",transform:"translate(-208.9778 -99.05999)",fill:"#ccc"})),Te=t=>{let r="";return t&&(w(t*1e3).utc().isAfter(w().utc())?r="Expires "+w().to(w(t*1e3).utc()):r="Expired "+w().from(w(t*1e3).utc())),r},ir=h(lr),cr=h(qe,{baseStyle:{w:5,h:5}}),be=h(Xe,{baseStyle:{w:5,h:5}}),dr=h(Ke,{baseStyle:{w:5,h:5}}),pr=h(Se,{baseStyle:{w:5,h:5}}),hr=h(Ie,{baseStyle:{w:5,h:5}}),ur=h(Je,{baseStyle:{strokeWidth:"2px",w:4,h:4}}),mr=h(et,{baseStyle:{strokeWidth:"2px",w:4,h:4}}),fr=h(tt,{baseStyle:{strokeWidth:"2px",w:4,h:4}}),gr={active:{statusColor:"green",bandWidthColor:"green"},expired:{statusColor:"gray",bandWidthColor:"gray"},limited:{statusColor:"red",bandWidthColor:"red"}},br=({expiryDate:t,status:r})=>{let a=Te(t);return o($,{children:[o(nt,{colorScheme:gr[r].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,experimental_spaceX:2,alignItems:"center",children:[r==="active"&&e(ur,{}),r==="limited"&&e(mr,{}),r==="expired"&&e(fr,{}),e(f,{textTransform:"capitalize",fontSize:".875rem",lineHeight:"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:r})]}),t&&e(f,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a})]})},xr=t=>{const{used:r,total:a,...c}=t,l=a===0||a===null,i=!l&&r/a*100>=100;return o($,{children:[e(st,{orientation:"horizontal",value:l?100:Math.min(r/a*100,100),colorScheme:i?"red":"primary",...c,children:e(lt,{h:"6px",borderRadius:"full",children:e(it,{borderRadius:"full"})})}),o(f,{fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[P(r)," /"," ",l?e(f,{as:"span",fontFamily:"system-ui",children:"\u221E"}):P(a)]})]})},yr=t=>{const{filteredUsers:r,users:a,onDeletingUser:c,onEditingUser:l,setQRCode:i}=W(),p=r.length!==a.length,[n,g]=s.exports.useState([-1,-1,!1]);return s.exports.useEffect(()=>{n[2]&&setTimeout(()=>{g([-1,-1,!1])},1e3)},[n]),o(_,{overflowX:"auto",maxW:"100vw",children:[o(rt,{...t,children:[e(ot,{children:o(fe,{children:[e(O,{children:"Username"}),e(O,{children:"status"}),e(O,{children:"banding usage"}),e(O,{})]})}),e(at,{children:r==null?void 0:r.map((u,b)=>{const y=u.links.join(`\r
`);return o(fe,{className:"interactive",onClick:()=>l(u),children:[e(V,{minW:"150px",children:u.username}),e(V,{width:"350px",children:e(br,{expiryDate:u.expire,status:u.status})}),e(V,{width:"300px",minW:"200px",children:e(xr,{used:u.used_traffic,total:u.data_limit,colorScheme:u.status==="limited"?"red":"primary"})}),e(V,{width:"150px",children:o(I,{justifyContent:"flex-end",onClick:C=>{C.preventDefault(),C.stopPropagation()},children:[e(ge,{text:u.subscription_url.startsWith("/")?window.location.origin+u.subscription_url:u.subscription_url,onCopy:()=>{g([b,0,!0])},children:e("div",{children:e(G,{label:n[0]===b&&n[1]==0&&n[2]?"Copied":"Copy Subscription Link",placement:"top",children:e(z,{"aria-label":"copy subscription link",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},children:n[0]===b&&n[1]==0&&n[2]?e(be,{}):e(dr,{})})})})}),e(ge,{text:y,onCopy:()=>{g([b,1,!0])},children:e("div",{children:e(G,{label:n[0]===b&&n[1]==1&&n[2]?"Copied":"Copy Configs",placement:"top",children:e(z,{"aria-label":"copy configs",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},children:n[0]===b&&n[1]==1&&n[2]?e(be,{}):e(cr,{})})})})}),e(G,{label:"QR Code",placement:"top",children:e(z,{"aria-label":"qr code",bg:"transparent",_dark:{_hover:{bg:"gray.700"}},onClick:()=>{i(u.links)},children:e(pr,{})})}),e(G,{label:"Delete",placement:"top",children:e(z,{"aria-label":"delete",p:2,bg:"transparent",_dark:{_hover:{bg:"gray.700"}},onClick:C=>{C.preventDefault(),C.stopPropagation(),c(u)},children:e(hr,{})})})]})})]},u.username)})})]}),r.length==0&&e(Cr,{isFiltered:p})]})},Cr=({isFiltered:t})=>{const{onCreateUser:r}=W();return o(_,{borderWidth:"1px",borderStyle:"solid",borderTop:0,borderBottomRadius:"8px",padding:"5",_dark:{borderColor:"gray.600"},py:"8",display:"flex",alignItems:"center",flexDirection:"column",experimental_spaceY:4,children:[e(ir,{maxHeight:"200px",maxWidth:"200px",_dark:{'path[fill="#fff"]':{fill:"gray.800"},'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.700"},'circle[fill="#3182CE"]':{fill:"primary.300"}},_light:{'path[fill="#f2f2f2"], path[fill="#e6e6e6"], path[fill="#ccc"]':{fill:"gray.300"},'circle[fill="#3182CE"]':{fill:"primary.500"}}}),e(f,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:t?"It seems there is no user matched with what you are looking for":"There is no user added to the system"}),!t&&e(R,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:"Create user"})]})},kr=h(ct,{baseStyle:{w:4,h:4}}),wr=({...t})=>{const{loading:r,filters:a,onFilterChange:c}=W(),l=i=>{c({...a,search:i.target.value})};return e(dt,{templateColumns:{lg:"repeat(3, 1fr)",base:"repeat(1, 1fr)"},gap:4,...t,children:e(pt,{colSpan:1,children:o(_e,{children:[e(ht,{pointerEvents:"none",children:e(kr,{})}),e(ve,{type:"tel",placeholder:"Search",defaultValue:a.search||"",borderColor:"light-border",onChange:l}),r&&e(Ee,{children:e(ee,{size:"xs"})})]})})})},le=({children:t,color:r})=>e(_,{position:"relative",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",_before:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100%)",height:"calc(100%)",bg:`${r}.400`,opacity:".5",borderRadius:"5px",zIndex:"1",_dark:{bg:`${r}.400`}},_after:{content:'""',display:"block",position:"absolute",top:"0",left:"0",width:"calc(100% + 10px)",height:"calc(100% + 10px)",transform:"translate(-5px, -5px)",bg:`${r}.400`,opacity:".4",borderRadius:"8px",zIndex:"1",_dark:{bg:`${r}.400`}},children:e(f,{color:`${r}.500`,_dark:{color:`${r}.900`},position:"relative",zIndex:"2",children:t})}),Sr=h(ut,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),Ir=h(mt,{baseStyle:{strokeWidth:"2px",w:5,h:5}}),_r=({disabled:t,title:r,description:a,...c})=>{const{getCheckboxProps:l,getInputProps:i,getLabelProps:p,htmlProps:n}=gt(c);return o(_,{as:"label",children:[e("input",{...i()}),o(_,{w:"fll",position:"relative",...n,cursor:"pointer",borderRadius:"md",border:"1px solid",borderColor:"gray.200",_dark:{borderColor:"gray.600"},_checked:{bg:"gray.50",outline:"2px",boxShadow:"outline",outlineColor:"primary.500",borderColor:"transparent",fontWeight:"medium",_dark:{bg:"gray.750",borderColor:"transparent"},"& > svg":{opacity:1,"&.checked":{display:"block"},"&.unchecked":{display:"none"}},"& p":{opacity:1}},__css:{"& > svg":{opacity:.3,"&.checked":{display:"none"},"&.unchecked":{display:"block"}},"& p":{opacity:.8}},textTransform:"capitalize",px:3,py:2,fontWeight:"medium",...l(),children:[e(Sr,{className:"checked",color:"primary.200",position:"absolute",right:"3",top:"3"}),e(Ir,{className:"unchecked",color:"primary.200",position:"absolute",right:"3",top:"3"}),e(f,{fontSize:"sm",color:"gray.700",_dark:{color:"gray.300"},...p(),children:r}),e(f,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},fontSize:"xs",children:a})]})]})},vr=s.exports.forwardRef(({name:t,list:r,onChange:a,disabled:c,...l},i)=>{const{getCheckboxProps:p}=ft({defaultValue:l.value,onChange:n=>{a({target:{value:n,name:t}})}});return e(Ue,{ref:i,experimental_spaceY:1,alignItems:"flex-start",columns:1,spacing:1,children:r.map(n=>e(_r,{disabled:c,title:n.title,description:n.description,...p({value:n.title})},n.title))})}),Er=h(bt,{baseStyle:{w:4,h:4}}),N=Q.forwardRef(({disabled:t,step:r,label:a,className:c,startAdornment:l,endAdornment:i,type:p="text",placeholder:n,onChange:g,onBlur:u,name:b,value:y,onClick:C,error:S,clearable:m=!1,...U},T)=>{const d=()=>{g&&g({target:{value:"",name:b}})},{size:B="md"}=U,Z=p=="number"?_t:ve,j=p=="number"?xt:Q.Fragment,x=p=="number"?{name:b,type:p,placeholder:n,onChange:M=>{g&&g(M)},onBlur:u,value:y,onClick:C,disabled:t,flexGrow:1,size:B}:{};return o(L,{isInvalid:!!S,children:[a&&e(F,{children:a}),o(_e,{size:B,w:"full",rounded:"md",_focusWithin:{outline:"2px solid",outlineColor:"primary.200"},bg:t?"gray.100":"transparent",_dark:{bg:t?"gray.600":"transparent"},children:[l&&e(yt,{children:l}),o(j,{...x,children:[e(Z,{name:b,ref:T,step:r,className:Ct(c),type:p,placeholder:n,onChange:g,onBlur:u,value:y,onClick:C,disabled:t,roundedLeft:l?"0":"md",roundedRight:i?"0":"md",flexGrow:1,_focusVisible:{outline:"none",borderTopColor:"transparent",borderRightColor:"transparent",borderBottomColor:"transparent"},_disabled:{cursor:"not-allowed"},...U}),p=="number"&&e($,{children:o(kt,{children:[e(wt,{}),e(St,{})]})})]}),i&&e(It,{borderRadius:"6px",bg:"transparent",children:i}),m&&y&&y.length&&e(Ee,{borderRadius:"6px",bg:"transparent",onClick:d,cursor:"pointer",children:e(Er,{})})]}),!!S&&e(Me,{children:S})]})}),Be=h(Ie,{baseStyle:{w:5,h:5}}),Ur=()=>{const[t,r]=s.exports.useState(!1),{deletingUser:a,onDeletingUser:c,deleteUser:l}=W(),i=()=>{c(null)},p=()=>{a&&(r(!0),l(a).then(i).finally(r.bind(null,!1)))};return o(te,{isCentered:!0,isOpen:!!a,onClose:i,size:"sm",children:[e(re,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),o(oe,{mx:"3",children:[e(ae,{pt:6,children:e(le,{color:"red",children:e(Be,{})})}),e(ne,{mt:3}),o(se,{children:[e(f,{fontWeight:"semibold",fontSize:"lg",children:"Delete user"}),a&&o(f,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:["Are you sure you want to delete ",e("b",{children:a.username}),"?"]})]}),o(ze,{display:"flex",children:[e(R,{size:"sm",onClick:i,mr:3,w:"full",variant:"outline",children:"Cancel"}),e(R,{size:"sm",w:"full",colorScheme:"red",onClick:p,leftIcon:t?e(ee,{size:"xs"}):void 0,children:"Delete"})]})]})]})},Mr=h(vt,{baseStyle:{w:5,h:5}}),zr=h(Et,{baseStyle:{w:5,h:5}}),Rr=E.object({username:E.string().min(1,{message:"Required"}),proxies:E.array(E.string()).refine(t=>t.length>0,{message:"Please select at least one protocol"}),data_limit:E.number().min(0,"The minimum number is 0").nullable(),expire:E.number().nullable()}),xe=t=>({...t,proxies:Object.keys(t.proxies)}),ye=()=>({proxies:["vmess","vless","trojan"],data_limit:null,expire:null,username:""}),Lr=(t,r)=>{const a=t.reduce((c,l)=>({...c,[l]:{}}),{});return r&&t.forEach(c=>{r[c]&&(a[c]=r[c])}),a},Fr=()=>{var B,Z,j;const{editingUser:t,isCreatingNewUser:r,onCreateUser:a,editUser:c,onEditingUser:l,createUser:i,onDeletingUser:p}=W(),n=!!t,g=r||n,[u,b]=s.exports.useState(!1),[y,C]=s.exports.useState(""),S=Ut(),m=Re({defaultValues:ye(),resolver:Le(Rr)}),U=()=>{m.reset(ye()),a(!1),l(null)},T=x=>{b(!0);const M={edited:c,created:i},v=n?"edited":"created";C(null);let A={...x,proxies:Lr(x.proxies,t==null?void 0:t.proxies)};M[v](A).then(()=>{S({title:`User ${x.username} ${v}.`,status:"success",isClosable:!0,position:"top",duration:3e3}),U()}).catch(k=>{var ie,ce,de,pe,he;(((ie=k==null?void 0:k.response)==null?void 0:ie.status)===409||((ce=k==null?void 0:k.response)==null?void 0:ce.status)===400)&&C((pe=(de=k==null?void 0:k.response)==null?void 0:de._data)==null?void 0:pe.detail),((he=k==null?void 0:k.response)==null?void 0:he.status)===422&&Object.keys(k.response._data.detail).forEach(ue=>{m.setError(ue,{type:"custom",message:k.response._data.detail[ue]})})}).finally(()=>{b(!1)})};s.exports.useEffect(()=>{t&&(console.log(xe(t)),m.reset(xe(t)))},[t]);const d=u;return o(te,{isOpen:g,onClose:U,size:"2xl",children:[e(re,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e(oe,{mx:"3",children:o("form",{onSubmit:m.handleSubmit(T),children:[e(ae,{pt:6,children:o(I,{gap:2,children:[e(le,{color:"primary",children:n?e(zr,{color:"white"}):e(Mr,{color:"white"})}),o(f,{fontWeight:"semibold",fontSize:"lg",children:[n?"Edit":"Create new"," user"]})]})}),e(ne,{mt:3,disabled:d}),o(se,{children:[o(Ue,{columns:{base:1,md:2},spacing:3,mt:4,children:[o(D,{justifyContent:"space-between",children:[o(D,{gap:1,gridAutoRows:"min-content",w:"full",children:[o(L,{children:[e(F,{children:"Username"}),e(N,{size:"sm",type:"text",borderRadius:"6px",error:(B=m.formState.errors.username)==null?void 0:B.message,disabled:d||n,...m.register("username")})]}),o(L,{children:[e(F,{children:"Bandwidth Limit"}),e(Y,{control:m.control,name:"data_limit",render:({field:x})=>{var M;return e(N,{endAdornment:"GB",type:"number",size:"sm",borderRadius:"6px",onChange:v=>{x.onChange(v&&v.length?Number((parseFloat(v)*1073741824).toFixed(3)):0)},disabled:d,error:(M=m.formState.errors.data_limit)==null?void 0:M.message,value:x.value?String(x.value/1073741824):void 0})}})]}),o(L,{children:[e(F,{children:"Expiry Date"}),e(Y,{name:"expire",control:m.control,render:({field:x})=>{var v;function M(A){return w(w(A*1e3).utc().format("MMMM D, YYYY")).toDate()}return o($,{children:[e(Mt,{dateFormat:"MMMM d, yyy",minDate:new Date,selected:x.value?M(x.value):void 0,onChange:A=>{x.onChange({target:{value:A?w(w(A).set("hour",23).set("minute",59).set("second",59)).utc().valueOf()/1e3:0,name:"expire"}})},customInput:e(N,{size:"sm",type:"text",borderRadius:"6px",clearable:!0,disabled:d,error:(v=m.formState.errors.expire)==null?void 0:v.message})}),x.value?e(zt,{children:Te(x.value)}):""]})}})]})]}),y&&o(X,{status:"error",display:{base:"none",md:"flex"},children:[e(K,{}),y]})]}),o(L,{isInvalid:!!((Z=m.formState.errors.proxies)!=null&&Z.message),children:[e(F,{children:"Protocols"}),e(Y,{control:m.control,name:"proxies",render:({field:x})=>e(vr,{list:[{title:"vmess",description:"Fast and secure"},{title:"vless",description:"Lightweight, fast and secure"},{title:"trojan",description:"Lightweight, secure and lightening fast"},{title:"shadowsocks",description:"Fast and secure, but not efficient as others"}],disabled:d,...x})}),e(Me,{children:(j=m.formState.errors.proxies)==null?void 0:j.message})]})]}),y&&o(X,{mt:"3",status:"error",display:{base:"flex",md:"none"},children:[e(K,{}),y]})]}),e(ze,{mt:"3",children:o(I,{justifyContent:"space-between",w:"full",gap:3,children:[e(I,{children:n&&e($,{children:e(z,{"aria-label":"Delete",size:"sm",onClick:()=>p(t),children:e(Be,{})})})}),o(I,{w:"full",maxW:{lg:"50%",base:"full"},children:[e(R,{onClick:U,size:"sm",variant:"outline",w:"full",disabled:d,children:"Cancel"}),e(R,{type:"submit",size:"sm",colorScheme:"primary",leftIcon:u?e(ee,{size:"xs"}):void 0,w:"full",disabled:d,children:n?"Edit user":"Create user"})]})]})})]})})]})};const Wr=h(Rt),Ar=h(Lt,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Dr=h(Ft,{baseStyle:{w:6,h:6,color:"gray.600",_dark:{color:"white"}}}),Tr=h(Se,{baseStyle:{w:5,h:5}}),Br=()=>{const{qrcodeLinks:t,setQRCode:r}=W(),a=t!==null,[c,l]=s.exports.useState(0);return o(te,{isOpen:a,onClose:()=>{r(null)},children:[e(re,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),o(oe,{mx:"3",w:"fit-content",maxW:"3xl",children:[e(ae,{pt:6,children:e(le,{color:"primary",children:e(Tr,{color:"white"})})}),e(ne,{mt:3}),t&&e(se,{w:"440px",display:"flex",justifyContent:"center",children:o(_,{w:"300px",children:[e(Wt,{centerPadding:"0px",centerMode:!0,slidesToShow:1,slidesToScroll:1,dots:!1,afterChange:l,onInit:()=>l(0),nextArrow:e(z,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"next",children:e(Ar,{})}),prevArrow:e(z,{size:"sm",position:"absolute",display:"flex !important",_before:{content:'""'},"aria-label":"prev",children:e(Dr,{})}),children:t.map((p,n)=>e(I,{children:e(Wr,{mx:"auto",size:300,p:"2",level:"L",includeMargin:!1,value:p})},n))}),o(f,{display:"block",textAlign:"center",pb:3,mt:1,children:[c+1," / ",t.length]})]})})]})]})},Hr=()=>{const{onCreateUser:t}=W();return o(D,{justifyContent:"space-between",minH:"100vh",p:"6",experimental_spaceY:4,children:[o(_,{w:"full",children:[e(sr,{actions:e(R,{colorScheme:"primary",size:"sm",onClick:()=>t(!0),children:"Create user"})}),e(rr,{mt:"4"}),e(wr,{mt:"4"}),e(yr,{mt:"4"}),e(Fr,{}),e(Ur,{}),e(Br,{})]}),e(De,{})]})},Pr=E.object({username:E.string().min(1,"This field is required"),password:E.string().min(1,"This field is required")}),Nr=h(At,{baseStyle:{w:10,h:10}}),Ce=()=>{var b,y;const[t,r]=s.exports.useState(""),[a,c]=s.exports.useState(!1),l=Dt();let i=we();const{register:p,formState:{errors:n},handleSubmit:g}=Re({resolver:Le(Pr)});return s.exports.useEffect(()=>{i.pathname!=="/login"&&l("/login",{replace:!0})},[]),o(D,{justifyContent:"space-between",minH:"100vh",children:[e(I,{w:"full",justifyContent:"center",alignItems:"center",children:o(_,{w:"full",maxW:"340px",mt:"6",children:[o(D,{alignItems:"center",w:"full",children:[e(Nr,{}),e(f,{fontSize:"2xl",fontWeight:"semibold",children:"Login to your account"}),e(f,{color:"gray.600",_dark:{color:"gray.400"},children:"Welcome back, please enter your details"})]}),e("form",{onSubmit:g(C=>{r("");const S=new FormData;S.append("username",C.username),S.append("password",C.password),S.append("grant_type","password"),c(!0),H("/admin/token",{method:"post",body:S}).then(({access_token:m})=>{Qt(m),l("/")}).catch(m=>{r(m.response._data.detail)}).finally(c.bind(null,!1))}),children:o(D,{mt:4,experimental_spaceY:4,children:[o(L,{children:[e(F,{children:"Username"}),e(N,{w:"full",placeholder:"Username",...p("username"),error:(b=n==null?void 0:n.username)==null?void 0:b.message})]}),o(L,{children:[e(F,{children:"Password"}),e(N,{w:"full",type:"password",placeholder:"Password",...p("password"),error:(y=n==null?void 0:n.password)==null?void 0:y.message})]}),t&&o(X,{status:"error",rounded:"md",children:[e(K,{}),e(Tt,{children:t})]}),e(R,{isLoading:a,type:"submit",w:"full",colorScheme:"primary",children:"Login"})]})})]})}),e(De,{})]})},$r=()=>H("/admin",{headers:{Authorization:`Bearer ${J()}`}}),Zr=Bt([{path:"/",element:e(Xt,{children:e(Hr,{})}),errorElement:e(Ce,{}),loader:$r},{path:"/login/",element:e(Ce,{})}],{basename:"/dashboard/"});function jr(){return e("main",{className:"p-8",children:e(Ht,{router:Zr})})}w.extend(Pt);w.extend(Nt);w.extend($t);w.extend(Zt);jt.createRoot(document.getElementById("root")).render(e(Q.StrictMode,{children:e(Ot,{theme:Gt,children:e(Vt,{value:{fetcher:Fe,revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!0},children:e(jr,{})})})}));
